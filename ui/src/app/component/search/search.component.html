<ng-container *ngIf="auth.canSearch(); else unauthorised">
  <div class="progress rounded-0 position-absolute h-1 w-100" *ngIf="searching">
    <div class="progress-bar progress-bar-striped progress-bar-animated bg-info w-100"></div>
  </div>
  <div class="jumbotron animate-padding" [ngClass]="{'jumbotron-compact': users.length > 0}">
    <div class="container">
      <h1>Search</h1>
      <form (ngSubmit)="search()" #form="ngForm">
        <div class="form-group">
          <label for="query" [class.mb-0]="recentUsers.length > 0">
              Use this screen to search for an existing user<ng-container *ngIf="auth.canAddUser()" >, or
              <a id="add-user-link" routerLink="/user">click here to add a new user</a> </ng-container>.
          </label>
          <p class="small" *ngIf="recentUsers.length > 0">
            Recently viewed:
            <span *ngFor="let username of recentUsers; let isLast = last">
              <a routerLink="/user/{{username}}" (keyup.enter)="router.navigate(['/user/'+username])">{{username}}</a>{{isLast? '': ','}}
            </span>
            <a (click)="clearRecentUsers()" title="Clear" style="cursor: pointer">&times;</a>
          </p>
          <div class="input-group">
            <input #queryInput="ngModel" id="query" name="query" type="search" class="form-control" [(ngModel)]="query"
                   placeholder="Search using name, username, team, staff code..."
                   autocomplete="off">
            <div class="input-group-append">
              <button class="btn btn-outline-secondary" type="button"
                      title="Show/hide search filters"
                      data-toggle="collapse" data-target="#filters"
                      aria-expanded="false" aria-controls="collapseExample">
                <span class="oi oi-chevron-bottom"></span>
              </button>
              <button class="btn btn-primary" type="submit"
                      [title]="searching? 'Searching...': 'Search'"
                      [disabled]="searching">
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" *ngIf="searching"></span>
                <span class="oi oi-magnifying-glass" *ngIf="!searching"></span>
              </button>
            </div>
          </div>
          <div id="filters" class="collapse float-right">
            <div class="bg-light border-left border-right border-bottom card-body py-2 rounded-bottom">
              <div class="custom-control custom-checkbox">
                <input id="include-inactive-users-filter" name="include-inactive-users-filter" class="custom-control-input"
                       [(ngModel)]="includeInactiveUsers"
                       (change)="search()"
                       type="checkbox"/>
                <label for="include-inactive-users-filter" class="custom-control-label"
                       title="Toggle whether to display users with an end date in the past">
                  Include inactive users?
                </label>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
  <div class="container" *ngIf="!searching && noResults && query != ''">
    <div class="card card-body bg-light">No results&hellip;</div>
  </div>
  <div class="container" *ngIf="users.length > 0">
    <div class="card">
      <div class="border-top-0 table-responsive">
        <table class="table table-hover mb-0">
          <thead class="thead-light">
            <tr>
              <th>Name</th>
              <th>Username</th>
              <th class="text-truncate">Staff Code</th>
              <th>Team(s)</th>
              <th *ngIf="includeInactiveUsers" class="text-nowrap">End Date</th>
              <th colspan="3" class="text-right">Sources</th>
              <th></th>
            </tr>
          </thead>
          <tbody style="cursor: pointer">
            <tr *ngFor="let user of users"
                routerLink="/user/{{user.username}}"
                (keyup.enter)="router.navigate(['/user/'+user.username])">
              <td title="Name">
                <a class="font-weight-bold text-dark" tabindex="-1"
                   routerLink="/user/{{user.username}}">{{user.forenames}} {{user.surname}}</a>
              </td>
              <td title="Username">{{user.username}}</td>
              <td title="Staff Code">{{user.staffCode}}</td>
              <td class="w-25" [title]="teamDescriptions(user.teams)">
                <span *ngIf="user.teams != null && user.teams.length == 1">{{ user.teams[0].description }}</span>
                <span *ngIf="user.teams != null && user.teams.length > 1">{{ user.teams.length }} teams</span>
              </td>
              <td title="End Date" *ngIf="includeInactiveUsers" class="text-nowrap">{{ user.endDate }}</td>
              <td class="pl-1 pr-0 d-lg-none" colspan="3" style="width: 55px">
                <span class="badge badge-pill badge-success w-100 font-weight-normal" [class.d-none]="user.sources.indexOf('AD1') === -1"
                      title="TTP Active Directory">DOM1</span>
                <span class="badge badge-pill badge-success w-100 font-weight-normal" [class.d-none]="user.sources.indexOf('AD2') === -1"
                      title="Steria Active Directory">OMNI</span>
                <span class="badge badge-pill badge-success w-100 font-weight-normal" [class.d-none]="user.sources.indexOf('DB') === -1 && user.sources.indexOf('OID') === -1"
                      title="National Delius">NDelius</span>
              </td>

              <td class="pl-1 pr-0 d-none d-lg-table-cell" style="width: 55px">
                <span class="badge badge-pill badge-success w-100 font-weight-normal" [class.d-none]="user.sources.indexOf('AD1') === -1"
                      title="TTP Active Directory">DOM1</span>
              </td>
              <td class="pl-1 pr-0 d-none d-lg-table-cell" style="width: 55px">
                <span class="badge badge-pill badge-success w-100 font-weight-normal" [class.d-none]="user.sources.indexOf('AD2') === -1"
                      title="Steria Active Directory">OMNI</span>
              </td>
              <td class="pl-1 d-none d-lg-table-cell" style="width: 55px">
                <span class="badge badge-pill badge-success w-100 font-weight-normal" [class.d-none]="user.sources.indexOf('DB') === -1 && user.sources.indexOf('OID') === -1"
                      title="National Delius">NDelius</span>
              </td>

              <td class="text-right">
                <span class="oi oi-chevron-right"></span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <hr/>
    <div class="btn-toolbar justify-content-center">
      <div class="btn-group">
        <button id="search-results-next" class="btn btn-outline-secondary"
                [hidden]="users.length % 10 != 0 || hasMoreResults === false"
                [disabled] = "searching"
                (click)="nextPage()">
          {{searching ? 'Loading': 'Load more'}}
          <span class="oi oi-arrow-circle-bottom"></span>
        </button>
      </div>
    </div>
    <br/>
  </div>
</ng-container>
<ng-template #unauthorised>You are not authorised to search for users.</ng-template>
